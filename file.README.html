<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><p><img src="http://ktonon.github.com/cog/images/cog-logo-small.png" alt="cog"></p>

<p><code>cog</code> is a command line utility that makes it a bit easier to organize a project
which uses code generation.</p>

<p><strong>This project is still under development</strong></p>

<p>See also</p>

<ul>
<li><a href="http://youtu.be/lH_q0aPqRzo">Video introduction to cog</a></li>
<li><a href="http://ktonon.github.com/cog/Cog.html">API docs</a></li>
</ul>

<h2>Get it</h2>

<p>Install the <a href="https://rubygems.org/gems/cog">cog gem</a> from a terminal</p>

<pre class="code bash"><code>$ gem install cog
</code></pre>

<h2>Prepare a project</h2>

<p>Consider an existing project with the following directory layout</p>

<pre class="code text"><code>PROJECT_ROOT/
             Makefile
             src/
                 main.cpp
                 ...
</code></pre>

<p>To use <code>cog</code> with this project, you would first open a terminal and change to
the <code>PROJECT_ROOT</code> directory. Then enter</p>

<pre class="code bash"><code>$ cog init
Created Cogfile
Created cog/generators
Created cog/templates
</code></pre>

<p>Now your project&#39;s directory layout will look like this</p>

<pre class="code text"><code>PROJECT_ROOT/
           + Cogfile
             Makefile
             src/
                 main.cpp
                 ...
           + cog/
           +     generators/
           +     templates/
</code></pre>

<p>The <a href="http://ktonon.github.com/cog/Cog/Config/Cogfile.html">Cogfile</a> configures
<code>cog</code> for use with your project. In short, it tells <code>cog</code> where to find generators and templates
and where to put generated source code. It should look like this when you first create
it</p>

<pre class="code ruby"><code><span class='comment val'># All paths are relative to the directory containing this file.</span>

<span class='comment val'># Define the directory in which to find project generators</span>
<span class='rubyid_project_generators_path identifier id'>project_generators_path</span> <span class='string val'>'cog/generators'</span>

<span class='comment val'># Define the directory in which to find custom project templates</span>
<span class='rubyid_project_templates_path identifier id'>project_templates_path</span> <span class='string val'>'cog/templates'</span>

<span class='comment val'># Define the directory to which project source code is generated</span>
<span class='rubyid_project_source_path identifier id'>project_source_path</span> <span class='string val'>'src'</span>

<span class='comment val'># Explicitly specify a mapping from file extensions to languages</span>
<span class='comment val'>#</span>
<span class='comment val'># key =&gt; value pairs from this mapping will override the default</span>
<span class='comment val'># language map supplied by +cog+</span>
<span class='comment val'>#</span>
<span class='comment val'># Type `cog language list` to see a list of supported languages</span>
<span class='comment val'># and the current file extension mappings</span>
<span class='rubyid_language_extensions identifier id'>language_extensions</span><span class='lparen token'>(</span><span class='lbrace token'>{</span>
  <span class='comment val'># :h =&gt; 'c++',</span>
  <span class='rbrace token'>}</span><span class='rparen token'>)</span>

<span class='comment val'># Define the target language which should be used when</span>
<span class='comment val'># creating generators, and no language is explicitly specified</span>
<span class='rubyid_default_target_language identifier id'>default_target_language</span> <span class='string val'>'c++'</span>
</code></pre>

<h2>Generators</h2>

<p>A generator is a ruby file which resides in the <code>project_generators_path</code>
and performs its work at the time it is required.
A basic generator can be created using the command line tool once a project has
been initialized</p>

<pre class="code bash"><code>$ cog generator new my_generator
Created cog/generators/my_generator.rb
Created cog/templates/my_generator.cpp.erb
Created cog/templates/my_generator.hpp.erb
</code></pre>

<p>Notice that a generator with C++ templates was created. That is because the
<a href="http://ktonon.github.com/cog/Cog/Config/Cogfile.html#default_target_language-instance_method">default_target_language</a>
in the Cogfile was set to <code>c++</code>. You can see a list of other possible settings by running <code>cog language list</code>.</p>

<p>Here is what <code>my_generator.rb</code> will look like</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>'cog'</span>

<span class='rubyid_class class kw'>class</span> <span class='rubyid_MyGenerator constant id'>MyGenerator</span> 
  <span class='rubyid_include identifier id'>include</span> <span class='rubyid_Cog constant id'>Cog</span><span class='colon2 op'>::</span><span class='rubyid_Generator constant id'>Generator</span>

  <span class='rubyid_def def kw'>def</span> <span class='rubyid_generate identifier id'>generate</span>
    <span class='rubyid_@class ivar id'>@class</span> <span class='assign token'>=</span> <span class='string val'>'my_generator'</span>
    <span class='rubyid_stamp identifier id'>stamp</span> <span class='string val'>'my_generator.cpp'</span><span class='comma token'>,</span> <span class='string val'>'generated_my_generator.cpp'</span>
    <span class='rubyid_stamp identifier id'>stamp</span> <span class='string val'>'my_generator.hpp'</span><span class='comma token'>,</span> <span class='string val'>'generated_my_generator.hpp'</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_MyGenerator constant id'>MyGenerator</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='dot token'>.</span><span class='rubyid_generate identifier id'>generate</span>
</code></pre>

<p>The important part is the last line. Just requiring this file causes it to run the generation procedure.</p>

<p>The inclusion of the mixin
<a href="http://ktonon.github.com/cog/Cog/Generator.html">Cog::Generator</a> is a
convenience, but is practically always done (either explicitly or implicitly). It provides an interface for easily
generating source code from templates. The
<a href="http://ktonon.github.com/cog/Cog/Generator.html#method-i-stamp">stamp</a> method
is particularly useful. If finds an <a href="http://www.stuartellis.eu/articles/erb/">ERB template</a>
in the <a href="http://ktonon.github.com/cog/Cog/Config.html#template_paths-instance_method">template_paths</a>
and renders it to a file under the
<a href="http://ktonon.github.com/cog/Cog/Config.html#project_source_path-instance_method">project_source_path</a>.
The <a href="http://ktonon.github.com/cog/Cog/Config.html#project_templates_path-instance_method">project_templates_path</a>
is in the <a href="http://ktonon.github.com/cog/Cog/Config.html#template_paths-instance_method">template_paths</a>
and takes the highest precedence.</p>

<p>This is what <code>my_generator.hpp.erb</code> will look like</p>

<pre class="code c++"><code>&lt;%= warning %&gt; 

class &lt;%= @class %&gt;
{
    &lt;%= @class %&gt;();
};
</code></pre>

<p>Now that you have a generator, you can run it like this</p>

<pre class="code bash"><code>$ cog gen run my_generator
Created src/generated_my_generator.cpp
Created src/generated_my_generator.hpp
</code></pre>

<p>and the contents of the generated file will be</p>

<pre class="code c++"><code>/*
-------------------------------------------------------------------------------

  WARNING

  This is a generated file. DO NOT EDIT THIS FILE! Your changes will
  be lost the next time this file is regenerated.

  This file was generated using cog
  https://github.com/ktonon/cog

-------------------------------------------------------------------------------
 */ 

class my_generator
{
    my_generator();
};
</code></pre>

<p>You can also list the project&#39;s generators like this</p>

<pre class="code bash"><code>$ cog gen list
my_generator

$ cog gen new --language=c# fishy
Created cog/generators/fishy.rb
Created cog/templates/fishy.cs.erb

$ cog generator list
fishy
my_generator
</code></pre>

<p>You can run all of the project&#39;s generators by excluding the generator name, like this</p>

<pre class="code bash"><code>$ cog gen run
Created src/generated_fishy.cs
</code></pre>

<p>In this case, both generators are run, but the original <code>my_generator</code> hasn&#39;t changed, so the generated file <code>generated_my_generator.txt</code> will not be touched.</p>

<h2>Tools</h2>

<p>While its possible to place all the code for your generator in the
<code>project_generators_path</code>, you might also consider writing a tool.</p>

<p>A tool is a separately distributed ruby gem which can be registered with <code>cog</code>
and contains templates for generator files. A tool should also provide a domain
specific language (DSL) in which the generator files created by the tool are
written.</p>

<p>You can tell <code>cog</code> to help you get started writing a tool. For example, if you
wanted to write a command line interface generation tool and call it <code>cons</code>, you
would do this</p>

<pre class="code bash"><code>$ cog tool new cons
Created cons/lib/cons.rb
Created cons/lib/cons/cog_tool.rb
Created cons/lib/cons/version.rb
Created cons/cog/templates/cons/generator.rb.erb
Created cons/cog/templates/cons/cons.txt.erb
Created cons/Gemfile
Created cons/Rakefile
Created cons/cons.gemspec
Created cons/LICENSE
Created cons/README.markdown
</code></pre>

<p>Tools are available across multiple projects. There are tools which come
built-in with <code>cog</code> and there are custom tools. In the previous example <code>cons</code>
was a custom tool. The set of custom tools are defined by the value of the
<code>COG_TOOLS</code> environment variable. The value of this variable is a colon (<code>:</code>)
separated list. Each entry should take one of two formats, either</p>

<ul>
<li>The name of the tool. For example <code>cons</code>.</li>
<li>File system path to the <code>cog_tool.rb</code> file. For example <code>/Users/ktonon/cons/lib/cons/cog_tool.rb</code>.  This form is useful during development of the tool itself.</li>
</ul>

<p>The directory structure of the tool is important. In the previous example, <code>cog</code> will assumes that the following paths will not be renamed or moved with respect to each other</p>

<pre class="code ruby"><code><span class='rubyid_cons identifier id'>cons</span><span class='div op'>/</span><span class='rubyid_lib identifier id'>lib</span><span class='div op'>/</span><span class='rubyid_cons identifier id'>cons</span><span class='dot token'>.</span><span class='rubyid_rb identifier id'>rb</span>
<span class='rubyid_cons identifier id'>cons</span><span class='div op'>/</span><span class='rubyid_lib identifier id'>lib</span><span class='div op'>/</span><span class='rubyid_cons identifier id'>cons</span><span class='div op'>/</span><span class='rubyid_cog_tool identifier id'>cog_tool</span><span class='dot token'>.</span><span class='rubyid_rb identifier id'>rb</span>
<span class='rubyid_cons identifier id'>cons</span><span class='div op'>/</span><span class='rubyid_cog identifier id'>cog</span><span class='div op'>/</span><span class='rubyid_templates identifier id'>templates</span><span class='div op'>/</span>
</code></pre>

<p>The <code>cog_tool.rb</code> is particularly important. It defines the method which stamps new generators for the tool. It looks like this</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>'cog'</span>

<span class='comment val'># Register cons as a tool with cog</span>
<span class='rubyid_Cog constant id'>Cog</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='dot token'>.</span><span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_register_tool identifier id'>register_tool</span> <span class='rubyid___FILE__ __file__ kw'>__FILE__</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_tool identifier id'>tool</span><span class='bitor op'>|</span>

  <span class='comment val'># Define how new cons generators are created</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Add context as required by your generator template.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># When the block is executed, +self+ will be an instance of Cog::Config::Tool::GeneratorStamper</span>
  <span class='rubyid_tool identifier id'>tool</span><span class='dot token'>.</span><span class='rubyid_stamp_generator identifier id'>stamp_generator</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_stamp identifier id'>stamp</span> <span class='string val'>'cons/generator.rb'</span><span class='comma token'>,</span> <span class='rubyid_generator_dest identifier id'>generator_dest</span><span class='comma token'>,</span> <span class='symbol val'>:absolute_destination</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_end end kw'>end</span>

<span class='rubyid_end end kw'>end</span>
</code></pre>

<p>You can see a list of the available tools like this</p>

<pre class="code bash"><code>$ cog tool list
basic
cons
</code></pre>

<p>As noted before, a tool should contain a template for making generators. In the
above example, that is the <code>generator.rb.erb</code> template. You can make a generator
using a custom tool like this</p>

<pre class="code bash"><code>$ cog --tool=cons gen new my_cons
Created cog/generators/my_cons.rb
</code></pre>

<p>This new generator will look something like this</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>'cons'</span>

<span class='rubyid_Cons constant id'>Cons</span><span class='dot token'>.</span><span class='rubyid_widget identifier id'>widget</span> <span class='string val'>'my_cons'</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_w identifier id'>w</span><span class='bitor op'>|</span>
  <span class='rubyid_w identifier id'>w</span><span class='dot token'>.</span><span class='rubyid_context identifier id'>context</span> <span class='assign token'>=</span> <span class='string val'>'this is the context'</span>
<span class='rubyid_end end kw'>end</span>
</code></pre>

<p>There is no explicit call to generate, but there is still a <code>generate</code> method on
the <code>Widget</code> class and it is called automatically when the block terminates.
Here is what the root tool file <code>cons.rb</code> will look like</p>

<pre class="code ruby"><code><span class='rubyid_$LOAD_PATH gvar id'>$LOAD_PATH</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid___FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_require identifier id'>require</span> <span class='string val'>'cons/version'</span>
<span class='rubyid_require identifier id'>require</span> <span class='string val'>'cog'</span>

<span class='comment val'># Custom cog tool cons </span>
<span class='rubyid_module module kw'>module</span> <span class='rubyid_Cons constant id'>Cons</span> 

  <span class='comment val'># Root of the DSL</span>
  <span class='comment val'># Feel free to rename this to something more appropriate</span>
  <span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_widget identifier id'>widget</span><span class='lparen token'>(</span><span class='rubyid_generator_name identifier id'>generator_name</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='rubyid_w identifier id'>w</span> <span class='assign token'>=</span> <span class='rubyid_Widget constant id'>Widget</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_generator_name identifier id'>generator_name</span>
    <span class='rubyid_block identifier id'>block</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span> <span class='rubyid_w identifier id'>w</span>

    <span class='comment val'># Activate cons while rendering templates</span>
    <span class='comment val'># so that cog will be able to find cons templates</span>
    <span class='rubyid_Cog constant id'>Cog</span><span class='colon2 op'>::</span><span class='rubyid_Config constant id'>Config</span><span class='dot token'>.</span><span class='rubyid_instance identifier id'>instance</span><span class='dot token'>.</span><span class='rubyid_activate_tool identifier id'>activate_tool</span> <span class='string val'>'cons'</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_w identifier id'>w</span><span class='dot token'>.</span><span class='rubyid_generate identifier id'>generate</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Root type of the DSL</span>
  <span class='comment val'># You'll want to rename this to something more meaningful</span>
  <span class='comment val'># and probably place it in a separate file.</span>
  <span class='rubyid_class class kw'>class</span> <span class='rubyid_Widget constant id'>Widget</span>

    <span class='rubyid_include identifier id'>include</span> <span class='rubyid_Cog constant id'>Cog</span><span class='colon2 op'>::</span><span class='rubyid_Generator constant id'>Generator</span>

    <span class='rubyid_attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:context</span>

    <span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_generator_name identifier id'>generator_name</span><span class='rparen token'>)</span>
      <span class='rubyid_@generator_name ivar id'>@generator_name</span> <span class='assign token'>=</span> <span class='rubyid_generator_name identifier id'>generator_name</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_def def kw'>def</span> <span class='rubyid_generate identifier id'>generate</span>
      <span class='rubyid_stamp identifier id'>stamp</span> <span class='string val'>'cons/cons.txt'</span><span class='comma token'>,</span> <span class='dstring node'>&quot;generated_#{@generator_name}.txt&quot;</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</code></pre>

<h2>API Documentation</h2>

<p>To get the most out of <code>cog</code> you&#39;ll need to refer to the <a href="http://ktonon.github.com/cog/">API docs</a>.</p>
</div></div>

    <div id="footer">
  Generated on Tue Nov 13 21:07:55 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.8.7).
</div>

  </body>
</html>